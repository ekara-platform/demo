name: ekara-demo
qualifier: dev

ekara:
  parent:
    repository: ekara-platform/distribution
  components:
    visualizer:
      repository: ekara-platform/swarm-visualizer-stack
    swarmpit:
      repository: swarmpit/swarmpit
      ref: 1.7

templates:
  - "docker-compose.yml"
  
nodes:
  '*':
    provider:
      name: ek-aws
      params:
        securityGroups:
          app:
            rules:
              - proto: tcp
                ports:
                  - {{ .Vars.app.visualizer.port }}
                  - {{ .Vars.app.web.port }}
                  - 8080
                cidr_ip: 0.0.0.0/0
                rule_desc: Allow inbound public traffic to all exposed services
        instances:
            instance_type: "t2.micro"
        volumes:
          docker:
            ebs:
              volume_size: 10
              delete_on_termination: true
              device_name: /dev/xvdf
            fs:
              mount_path: /var/lib/docker
  cache:
    instances: 3
    labels:
      role_cache: "yes"
  web:
    instances: 2
    labels:
      role_webserver: "yes"

stacks:
  visualizer:
    component: visualizer
  swarmpit:
    component: swarmpit
  app:
    component: _
